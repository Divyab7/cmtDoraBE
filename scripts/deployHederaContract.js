// Deploys the compiled contract bytecode to Hedera
require('dotenv').config();
const { Client, FileCreateTransaction, FileAppendTransaction, ContractCreateTransaction, PrivateKey } = require('@hashgraph/sdk');

// Paste your contract bytecode as a Buffer or Uint8Array below:
// Example: const contractBytecode = Buffer.from('6080...etc', 'hex');
// const contractBytecode = Buffer.from('PASTE_YOUR_BYTECODE_HERE', 'hex');
const contractBytecode = Buffer.from('6080604052348015600e575f80fd5b50611e4f8061001c5f395ff3fe608060405234801561000f575f80fd5b506004361061007b575f3560e01c8063594d24c611610059578063594d24c6146100fb5780638a6997231461012b578063aa0c148314610147578063d6fc7e40146101775761007b565b80630c06a3f31461007f578063247f1270146100af5780632bd0e27a146100df575b5f80fd5b61009960048036038101906100949190610e61565b6101a7565b6040516100a69190610fc3565b60405180910390f35b6100c960048036038101906100c49190611016565b610299565b6040516100d691906110b8565b60405180910390f35b6100f960048036038101906100f491906111ba565b61036a565b005b61011560048036038101906101109190611016565b6105c9565b60405161012291906110b8565b60405180910390f35b610145600480360381019061014091906112bd565b610692565b005b610161600480360381019061015c9190610e61565b610918565b60405161016e9190611545565b60405180910390f35b610191600480360381019061018c91906112bd565b610c2b565b60405161019e919061157f565b60405180910390f35b60606001826040516101b991906115d2565b9081526020016040518091039020805480602002602001604051908101604052809291908181526020015f905b8282101561028e578382905f5260205f2001805461020390611615565b80601f016020809104026020016040519081016040528092919081815260200182805461022f90611615565b801561027a5780601f106102515761010080835404028352916020019161027a565b820191905f5260205f20905b81548152906001019060200180831161025d57829003601f168201915b5050505050815260200190600101906101e6565b505050509050919050565b5f8280516020810182018051848252602083016020850120818352809550505050505081815481106102c9575f80fd5b905f5260205f2090600202015f9150915050805f0180546102e990611615565b80601f016020809104026020016040519081016040528092919081815260200182805461031590611615565b80156103605780601f1061033757610100808354040283529160200191610360565b820191905f5260205f20905b81548152906001019060200180831161034357829003601f168201915b5050505050905081565b8151835114801561037c575080518251145b6103bb576040517f08c379a00000000000000000000000000000000000000000000000000000000081526004016103b29061168f565b60405180910390fd5b5f856040516103ca91906115d2565b908152602001604051809103902060018160018154018082558091505003905f5260205f209050505f808660405161040291906115d2565b908152602001604051809103902060015f8860405161042191906115d2565b90815260200160405180910390208054905061043d91906116da565b8154811061044e5761044d61170d565b5b905f5260205f209060020201905084815f01908161046c91906118d7565b505f5b845181101561055a5781600101604051806060016040528087848151811061049a5761049961170d565b5b602002602001015181526020018684815181106104ba576104b961170d565b5b602002602001015181526020018584815181106104da576104d961170d565b5b6020026020010151815250908060018154018082558091505060019003905f5260205f2090600302015f909190919091505f820151815f01908161051e91906118d7565b50602082015181600101908161053491906118d7565b50604082015181600201908161054a91906118d7565b505050808060010191505061046f565b508460405161056991906115d2565b60405180910390208660405161057f91906115d2565b60405180910390207f3c3fa9644f8dd85036bbe69e092008a8e613d9d0b5e806e8b5372d5570f25ec9836001016040516105b99190611b3e565b60405180910390a3505050505050565b60018280516020810182018051848252602083016020850120818352809550505050505081815481106105fa575f80fd5b905f5260205f20015f9150915050805461061390611615565b80601f016020809104026020016040519081016040528092919081815260200182805461063f90611615565b801561068a5780601f106106615761010080835404028352916020019161068a565b820191905f5260205f20905b81548152906001019060200180831161066d57829003601f168201915b505050505081565b5f82511180156106a257505f8151115b6106e1576040517f08c379a00000000000000000000000000000000000000000000000000000000081526004016106d890611ba8565b60405180910390fd5b8080519060200120828051906020012003610731576040517f08c379a000000000000000000000000000000000000000000000000000000000815260040161072890611c10565b60405180910390fd5b5f60018360405161074291906115d2565b908152602001604051809103902090505f5b818054905081101561088857828051906020012082828154811061077b5761077a61170d565b5b905f5260205f20016040516107909190611cca565b60405180910390200361087b5781600183805490506107af91906116da565b815481106107c0576107bf61170d565b5b905f5260205f20018282815481106107db576107da61170d565b5b905f5260205f200190816107ef9190611d07565b508180548061080157610800611dec565b5b600190038181905f5260205f20015f61081a9190610cbc565b90558260405161082a91906115d2565b60405180910390208460405161084091906115d2565b60405180910390207fb08b37aafed4e369872d797a361b0107889ed8db9e0e4a36025f25122ddaf6be60405160405180910390a35050610914565b8080600101915050610754565b508082908060018154018082558091505060019003905f5260205f20015f9091909190915090816108b991906118d7565b50816040516108c891906115d2565b6040518091039020836040516108de91906115d2565b60405180910390207fb08b37aafed4e369872d797a361b0107889ed8db9e0e4a36025f25122ddaf6be60405160405180910390a3505b5050565b60605f8260405161092991906115d2565b9081526020016040518091039020805480602002602001604051908101604052809291908181526020015f905b82821015610c20578382905f5260205f2090600202016040518060400160405290815f8201805461098690611615565b80601f01602080910402602001604051908101604052809291908181526020018280546109b290611615565b80156109fd5780601f106109d4576101008083540402835291602001916109fd565b820191905f5260205f20905b8154815290600101906020018083116109e057829003601f168201915b5050505050815260200160018201805480602002602001604051908101604052809291908181526020015f905b82821015610c09578382905f5260205f2090600302016040518060600160405290815f82018054610a5a90611615565b80601f0160208091040260200160405190810160405280929190818152602001828054610a8690611615565b8015610ad15780601f10610aa857610100808354040283529160200191610ad1565b820191905f5260205f20905b815481529060010190602001808311610ab457829003601f168201915b50505050508152602001600182018054610aea90611615565b80601f0160208091040260200160405190810160405280929190818152602001828054610b1690611615565b8015610b615780601f10610b3857610100808354040283529160200191610b61565b820191905f5260205f20905b815481529060010190602001808311610b4457829003601f168201915b50505050508152602001600282018054610b7a90611615565b80601f0160208091040260200160405190810160405280929190818152602001828054610ba690611615565b8015610bf15780601f10610bc857610100808354040283529160200191610bf1565b820191905f5260205f20905b815481529060010190602001808311610bd457829003601f168201915b50505050508152505081526020019060010190610a2a565b505050508152505081526020019060010190610956565b505050509050919050565b5f80600184604051610c3d91906115d2565b908152602001604051809103902090505f5b8180549050811015610cb0578380519060200120828281548110610c7657610c7561170d565b5b905f5260205f2001604051610c8b9190611cca565b604051809103902003610ca357600192505050610cb6565b8080600101915050610c4f565b505f9150505b92915050565b508054610cc890611615565b5f825580601f10610cd95750610cf6565b601f0160209004905f5260205f2090810190610cf59190610cf9565b5b50565b5b80821115610d10575f815f905550600101610cfa565b5090565b5f604051905090565b5f80fd5b5f80fd5b5f80fd5b5f80fd5b5f601f19601f8301169050919050565b7f4e487b71000000000000000000000000000000000000000000000000000000005f52604160045260245ffd5b610d7382610d2d565b810181811067ffffffffffffffff82111715610d9257610d91610d3d565b5b80604052505050565b5f610da4610d14565b9050610db08282610d6a565b919050565b5f67ffffffffffffffff821115610dcf57610dce610d3d565b5b610dd882610d2d565b9050602081019050919050565b828183375f83830152505050565b5f610e05610e0084610db5565b610d9b565b905082815260208101848484011115610e2157610e20610d29565b5b610e2c848285610de5565b509392505050565b5f82601f830112610e4857610e47610d25565b5b8135610e58848260208601610df3565b91505092915050565b5f60208284031215610e7657610e75610d1d565b5b5f82013567ffffffffffffffff811115610e9357610e92610d21565b5b610e9f84828501610e34565b91505092915050565b5f81519050919050565b5f82825260208201905092915050565b5f819050602082019050919050565b5f81519050919050565b5f82825260208201905092915050565b8281835e5f83830152505050565b5f610f0382610ed1565b610f0d8185610edb565b9350610f1d818560208601610eeb565b610f2681610d2d565b840191505092915050565b5f610f3c8383610ef9565b905092915050565b5f602082019050919050565b5f610f5a82610ea8565b610f648185610eb2565b935083602082028501610f7685610ec2565b805f5b85811015610fb15784840389528151610f928582610f31565b9450610f9d83610f44565b925060208a01995050600181019050610f79565b50829750879550505050505092915050565b5f6020820190508181035f830152610fdb8184610f50565b905092915050565b5f819050919050565b610ff581610fe3565b8114610fff575f80fd5b50565b5f8135905061101081610fec565b92915050565b5f806040838503121561102c5761102b610d1d565b5b5f83013567ffffffffffffffff81111561104957611048610d21565b5b61105585828601610e34565b925050602061106685828601611002565b9150509250929050565b5f82825260208201905092915050565b5f61108a82610ed1565b6110948185611070565b93506110a4818560208601610eeb565b6110ad81610d2d565b840191505092915050565b5f6020820190508181035f8301526110d08184611080565b905092915050565b5f67ffffffffffffffff8211156110f2576110f1610d3d565b5b602082029050602081019050919050565b5f80fd5b5f611119611114846110d8565b610d9b565b9050808382526020820190506020840283018581111561113c5761113b611103565b5b835b8181101561118357803567ffffffffffffffff81111561116157611160610d25565b5b80860161116e8982610e34565b8552602085019450505060208101905061113e565b5050509392505050565b5f82601f8301126111a1576111a0610d25565b5b81356111b1848260208601611107565b91505092915050565b5f805f805f60a086880312156111d3576111d2610d1d565b5b5f86013567ffffffffffffffff8111156111f0576111ef610d21565b5b6111fc88828901610e34565b955050602086013567ffffffffffffffff81111561121d5761121c610d21565b5b61122988828901610e34565b945050604086013567ffffffffffffffff81111561124a57611249610d21565b5b6112568882890161118d565b935050606086013567ffffffffffffffff81111561127757611276610d21565b5b6112838882890161118d565b925050608086013567ffffffffffffffff8111156112a4576112a3610d21565b5b6112b08882890161118d565b9150509295509295909350565b5f80604083850312156112d3576112d2610d1d565b5b5f83013567ffffffffffffffff8111156112f0576112ef610d21565b5b6112fc85828601610e34565b925050602083013567ffffffffffffffff81111561131d5761131c610d21565b5b61132985828601610e34565b9150509250929050565b5f81519050919050565b5f82825260208201905092915050565b5f819050602082019050919050565b5f81519050919050565b5f82825260208201905092915050565b5f819050602082019050919050565b5f606083015f8301518482035f86015261139f8282610ef9565b915050602083015184820360208601526113b98282610ef9565b915050604083015184820360408601526113d38282610ef9565b9150508091505092915050565b5f6113eb8383611385565b905092915050565b5f602082019050919050565b5f6114098261135c565b6114138185611366565b93508360208202850161142585611376565b805f5b85811015611460578484038952815161144185826113e0565b945061144c836113f3565b925060208a01995050600181019050611428565b50829750879550505050505092915050565b5f604083015f8301518482035f86015261148c8282610ef9565b915050602083015184820360208601526114a682826113ff565b9150508091505092915050565b5f6114be8383611472565b905092915050565b5f602082019050919050565b5f6114dc82611333565b6114e6818561133d565b9350836020820285016114f88561134d565b805f5b85811015611533578484038952815161151485826114b3565b945061151f836114c6565b925060208a019950506001810190506114fb565b50829750879550505050505092915050565b5f6020820190508181035f83015261155d81846114d2565b905092915050565b5f8115159050919050565b61157981611565565b82525050565b5f6020820190506115925f830184611570565b92915050565b5f81905092915050565b5f6115ac82610ed1565b6115b68185611598565b93506115c6818560208601610eeb565b80840191505092915050565b5f6115dd82846115a2565b915081905092915050565b7f4e487b71000000000000000000000000000000000000000000000000000000005f52602260045260245ffd5b5f600282049050600182168061162c57607f821691505b60208210810361163f5761163e6115e8565b5b50919050565b7f4d69736d61746368656420696e707574206c656e6774687300000000000000005f82015250565b5f611679601883611070565b915061168482611645565b602082019050919050565b5f6020820190508181035f8301526116a68161166d565b9050919050565b7f4e487b71000000000000000000000000000000000000000000000000000000005f52601160045260245ffd5b5f6116e482610fe3565b91506116ef83610fe3565b9250828203905081811115611707576117066116ad565b5b92915050565b7f4e487b71000000000000000000000000000000000000000000000000000000005f52603260045260245ffd5b5f819050815f5260205f209050919050565b5f6020601f8301049050919050565b5f82821b905092915050565b5f600883026117967fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff8261175b565b6117a0868361175b565b95508019841693508086168417925050509392505050565b5f819050919050565b5f6117db6117d66117d184610fe3565b6117b8565b610fe3565b9050919050565b5f819050919050565b6117f4836117c1565b611808611800826117e2565b848454611767565b825550505050565b5f90565b61181c611810565b6118278184846117eb565b505050565b5b8181101561184a5761183f5f82611814565b60018101905061182d565b5050565b601f82111561188f576118608161173a565b6118698461174c565b81016020851015611878578190505b61188c6118848561174c565b83018261182c565b50505b505050565b5f82821c905092915050565b5f6118af5f1984600802611894565b1980831691505092915050565b5f6118c783836118a0565b9150826002028217905092915050565b6118e082610ed1565b67ffffffffffffffff8111156118f9576118f8610d3d565b5b6119038254611615565b61190e82828561184e565b5f60209050601f83116001811461193f575f841561192d578287015190505b61193785826118bc565b86555061199e565b601f19841661194d8661173a565b5f5b828110156119745784890151825560018201915060208501945060208101905061194f565b86831015611991578489015161198d601f8916826118a0565b8355505b6001600288020188555050505b505050505050565b5f81549050919050565b5f82825260208201905092915050565b5f819050815f5260205f209050919050565b5f81546119de81611615565b6119e88186610edb565b9450600182165f8114611a025760018114611a1857611a4a565b60ff198316865281151560200286019350611a4a565b611a218561173a565b5f5b83811015611a4257815481890152600182019150602081019050611a23565b808801955050505b50505092915050565b5f606083015f8084018583035f870152611a6d83826119d2565b925050600184018583036020870152611a8683826119d2565b925050600284018583036040870152611a9f83826119d2565b925050819250505092915050565b5f611ab88383611a53565b905092915050565b5f600382019050919050565b5f611ad6826119a6565b611ae081856119b0565b935083602082028501611af2856119c0565b805f5b85811015611b2c57848403895281611b0d8582611aad565b9450611b1883611ac0565b925060208a01995050600181019050611af5565b50829750879550505050505092915050565b5f6020820190508181035f830152611b568184611acc565b905092915050565b7f496e76616c6964207573657220494473000000000000000000000000000000005f82015250565b5f611b92601083611070565b9150611b9d82611b5e565b602082019050919050565b5f6020820190508181035f830152611bbf81611b86565b9050919050565b7f43616e6e6f7420666f6c6c6f7720796f757273656c66000000000000000000005f82015250565b5f611bfa601683611070565b9150611c0582611bc6565b602082019050919050565b5f6020820190508181035f830152611c2781611bee565b9050919050565b5f81905092915050565b5f819050815f5260205f209050919050565b5f8154611c5681611615565b611c608186611c2e565b9450600182165f8114611c7a5760018114611c8f57611cc1565b60ff1983168652811515820286019350611cc1565b611c9885611c38565b5f5b83811015611cb957815481890152600182019150602081019050611c9a565b838801955050505b50505092915050565b5f611cd58284611c4a565b915081905092915050565b5f81549050611cee81611615565b9050919050565b5f819050815f5260205f209050919050565b818103611d15575050611dea565b611d1e82611ce0565b67ffffffffffffffff811115611d3757611d36610d3d565b5b611d418254611615565b611d4c82828561184e565b5f601f831160018114611d79575f8415611d67578287015490505b611d7185826118bc565b865550611de3565b601f198416611d8787611cf5565b9650611d928661173a565b5f5b82811015611db957848901548255600182019150600185019450602081019050611d94565b86831015611dd65784890154611dd2601f8916826118a0565b8355505b6001600288020188555050505b5050505050505b565b7f4e487b71000000000000000000000000000000000000000000000000000000005f52603160045260245ffdfea26469706673582212204ee61d3830ee5a82818128f80e10babb750e10afc568e4bfa08e330b2d7051c164736f6c634300081a0033'); // <-- Assign your Buffer here

async function main() {
    // Load Hedera credentials from environment variables
    const HEDERA_ACCOUNT_ID = process.env.HEDERA_OPERATOR_ID;
    const HEDERA_PRIVATE_KEY = process.env.HEDERA_OPERATOR_KEY;
    console.log(HEDERA_ACCOUNT_ID, HEDERA_PRIVATE_KEY);
    if (!HEDERA_ACCOUNT_ID || !HEDERA_PRIVATE_KEY) {
        throw new Error('HEDERA_ACCOUNT_ID and HEDERA_PRIVATE_KEY must be set in the .env file');
    }

    // Setup Hedera client for testnet
    const client = Client.forMainnet();
    client.setOperator(HEDERA_ACCOUNT_ID, HEDERA_PRIVATE_KEY);

    // Create a file on Hedera and store the first chunk of bytecode
    const initialChunk = contractBytecode.slice(0, 4096); // first 4 KB
    const fileCreateTx = new FileCreateTransaction()
        .setContents(initialChunk)
        .setKeys([PrivateKey.fromString(HEDERA_PRIVATE_KEY).publicKey]);
    const fileCreateSubmit = await fileCreateTx.execute(client);
    const fileCreateRx = await fileCreateSubmit.getReceipt(client);
    const bytecodeFileId = fileCreateRx.fileId;
    console.log(`- The bytecode file ID is: ${bytecodeFileId} \n`);

    // Append remaining chunks if the bytecode exceeds 4 KB
    for (let i = 4096; i < contractBytecode.length; i += 4096) {
        const chunk = contractBytecode.slice(i, i + 4096);
        const fileAppendTx = new FileAppendTransaction()
            .setFileId(bytecodeFileId)
            .setContents(chunk)
            .setMaxChunks(10); // Allows the append to handle multiple chunks
        await fileAppendTx.execute(client);
    }

    // Instantiate the contract
    const contractInstantiateTx = new ContractCreateTransaction()
        .setBytecodeFileId(bytecodeFileId)
        .setGas(3000000);
    const contractInstantiateSubmit = await contractInstantiateTx.execute(client);
    const contractInstantiateRx = await contractInstantiateSubmit.getReceipt(client);
    const contractId = contractInstantiateRx.contractId;
    const contractAddress = contractId.toSolidityAddress();
    console.log(`- The contract ID is: ${contractId} \n`);
    console.log(`- The contract address (for use in Solidity) is: ${contractAddress} \n`);

    client.close();
}

main().catch((error) => {
    console.error(error);
    process.exitCode = 1;
}); 